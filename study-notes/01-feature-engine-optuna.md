Notebook



ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚° Ã— Optuna Ã— ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«å­¦ç¿’ã§0.78åˆ°é”

åˆå¿ƒè€…ã§ã‚‚åˆ†ã‹ã‚‹ï¼æ©Ÿæ¢°å­¦ç¿’ã®åŸºç¤ã‹ã‚‰å®Ÿè·µã¾ã§

ğŸ¯ ã“ã®è¨˜äº‹ã§å­¦ã¹ã‚‹ã“ã¨

æ¢ç´¢çš„ãƒ‡ãƒ¼ã‚¿åˆ†æï¼ˆEDAï¼‰ - ãƒ‡ãƒ¼ã‚¿ã®ä¸­èº«ã‚’ç†è§£ã™ã‚‹

ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚° - äºˆæ¸¬ç²¾åº¦ã‚’ä¸Šã’ã‚‹ç§˜è¨£

Optunaã«ã‚ˆã‚‹è‡ªå‹•ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚° - ãƒ™ã‚¹ãƒˆãªè¨­å®šã‚’è¦‹ã¤ã‘ã‚‹

ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«å­¦ç¿’ - è¤‡æ•°ã®ãƒ¢ãƒ‡ãƒ«ã‚’çµ„ã¿åˆã‚ã›ã‚‹

ã‚ªãƒ¼ãƒãƒ¼ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚° - æ©Ÿæ¢°å­¦ç¿’ã§æœ€ã‚‚é‡è¦ãªè½ã¨ã—ç©´

ğŸ“Š æœ€çµ‚çµæœ

CVï¼ˆäº¤å·®æ¤œè¨¼ï¼‰ã‚¹ã‚³ã‚¢: 0.8384

LBï¼ˆãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰ï¼‰ã‚¹ã‚³ã‚¢: 0.78299

ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«: Random Forest + Gradient Boosting + LightGBM ã®ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«

é‡è¦: CVã‚¹ã‚³ã‚¢ã¨LBã‚¹ã‚³ã‚¢ã«å¤§ããªå·®ãŒã‚ã‚‹ â†’ ã“ã‚ŒãŒã‚ªãƒ¼ãƒãƒ¼ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ï¼ˆéå­¦ç¿’ï¼‰ã®è¨¼æ‹ ã§ã™ã€‚ã“ã®è¨˜äº‹ã®æœ€å¤§ã®ãƒ†ãƒ¼ãƒã§ã™ã€‚

1ï¸âƒ£ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æº–å‚™

# ãƒ‡ãƒ¼ã‚¿å‡¦ç†ç”¨
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import warnings

# æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«
from sklearn.ensemble import RandomForestClassifier, GradientBoostingClassifier, VotingClassifier
from lightgbm import LGBMClassifier

# æœ€é©åŒ–ãƒ„ãƒ¼ãƒ«
import optuna
from sklearn.model_selection import StratifiedKFold, cross_val_score

# è¨­å®š
warnings.filterwarnings('ignore')
sns.set_style('whitegrid')


ğŸ“˜ è§£èª¬

å„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å½¹å‰²:

pandas/numpy: ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†ãŸã‚ã®åŸºæœ¬ãƒ„ãƒ¼ãƒ«ï¼ˆExcelã®ã‚ˆã†ãªè¡¨è¨ˆç®—ã‚’Pythonã§ï¼‰

matplotlib/seaborn: ã‚°ãƒ©ãƒ•ã‚’æããƒ„ãƒ¼ãƒ«

sklearn: æ©Ÿæ¢°å­¦ç¿’ã®é“å…·ç®±ï¼ˆæ§˜ã€…ãªãƒ¢ãƒ‡ãƒ«ã‚„è©•ä¾¡æ–¹æ³•ãŒå…¥ã£ã¦ã„ã‚‹ï¼‰

lightgbm: é«˜æ€§èƒ½ãªæ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã®ä¸€ã¤

optuna: è‡ªå‹•ã§ã€Œæœ€é©ãªè¨­å®šã€ã‚’æ¢ã—ã¦ãã‚Œã‚‹è³¢ã„ãƒ­ãƒœãƒƒãƒˆ

2ï¸âƒ£ ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã¨ç¢ºèª

train_df = pd.read_csv('/kaggle/input/titanic/train.csv')
test_df = pd.read_csv('/kaggle/input/titanic/test.csv')
all_data = pd.concat([train_df.drop('Survived', axis=1), test_df], sort=False).reset_index(drop=True)

print("è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã®å½¢:", train_df.shape)
print("ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®å½¢:", test_df.shape)
print("\næœ€åˆã®5è¡Œ:")
train_df.head()


ğŸ“˜ è§£èª¬

train.csv: ç­”ãˆï¼ˆç”Ÿå­˜ã—ãŸã‹ï¼‰ãŒä»˜ã„ã¦ã„ã‚‹å­¦ç¿’ç”¨ãƒ‡ãƒ¼ã‚¿ï¼ˆ891äººåˆ†ï¼‰

test.csv: ç­”ãˆãŒãªã„äºˆæ¸¬ç”¨ãƒ‡ãƒ¼ã‚¿ï¼ˆ418äººåˆ†ï¼‰

all_data: ä¸¡æ–¹ã‚’çµåˆã—ãŸãƒ‡ãƒ¼ã‚¿ï¼ˆç‰¹å¾´é‡ä½œæˆã‚’ä¸€æ‹¬ã§è¡Œã†ãŸã‚ï¼‰

3ï¸âƒ£ EDAï¼ˆæ¢ç´¢çš„ãƒ‡ãƒ¼ã‚¿åˆ†æï¼‰

æ¬ æå€¤ã®ç¢ºèª

print("æ¬ æå€¤ã®æ•°:")
train_df.isnull().sum()


çµæœ:

Ageï¼ˆå¹´é½¢ï¼‰: 177å€‹ã®æ¬ æ

Cabinï¼ˆå®¢å®¤ç•ªå·ï¼‰: 687å€‹ã®æ¬ æï¼ˆã»ã¨ã‚“ã©ãªã„ï¼‰

Embarkedï¼ˆä¹—èˆ¹æ¸¯ï¼‰: 2å€‹ã®æ¬ æ

ç”Ÿå­˜ç‡ã®å¯è¦–åŒ–

fig, axes = plt.subplots(2, 2, figsize=(16, 12))

# ç”Ÿå­˜è€…æ•°
sns.countplot(ax=axes[0, 0], x='Survived', data=train_df)
axes[0, 0].set_title('ç”Ÿå­˜è€…æ•°')

# æ€§åˆ¥ã¨ç”Ÿå­˜ç‡
sns.countplot(ax=axes[0, 1], x='Sex', hue='Survived', data=train_df)
axes[0, 1].set_title('æ€§åˆ¥ã”ã¨ã®ç”Ÿå­˜ç‡')

# å®¢å®¤ã‚¯ãƒ©ã‚¹ã¨ç”Ÿå­˜ç‡
sns.countplot(ax=axes[1, 0], x='Pclass', hue='Survived', data=train_df)
axes[1, 0].set_title('å®¢å®¤ã‚¯ãƒ©ã‚¹ã”ã¨ã®ç”Ÿå­˜ç‡')

# å¹´é½¢ã¨ç”Ÿå­˜ç‡
sns.histplot(ax=axes[1, 1], data=train_df, x='Age', hue='Survived', kde=True)
axes[1, 1].set_title('å¹´é½¢ã”ã¨ã®ç”Ÿå­˜ç‡')

plt.tight_layout()
plt.show()


ğŸ“Š EDAã‹ã‚‰åˆ†ã‹ã£ãŸã“ã¨

æ€§åˆ¥ï¼ˆSexï¼‰: å¥³æ€§ã®ç”Ÿå­˜ç‡ãŒåœ§å€’çš„ã«é«˜ã„ â†’ ã€Œå¥³æ€§ã¨å­ä¾›ãŒå„ªå…ˆã€

å®¢å®¤ã‚¯ãƒ©ã‚¹ï¼ˆPclassï¼‰: 1ç­‰å®¢å®¤ã®ç”Ÿå­˜ç‡ãŒé«˜ã„ â†’ ãŠé‡‘æŒã¡ãŒå„ªé‡ã•ã‚ŒãŸ

å¹´é½¢ï¼ˆAgeï¼‰: å­ä¾›ã®ç”Ÿå­˜ç‡ãŒé«˜ã„å‚¾å‘

ã“ã‚Œã‚‰ã®æƒ…å ±ã‚’å…ƒã«ã€Œç‰¹å¾´é‡ã€ã‚’ä½œã‚Šã¾ã™ï¼

4ï¸âƒ£ ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ï¼ˆäºˆæ¸¬ç²¾åº¦ã®éµï¼‰

A. Titleï¼ˆæ•¬ç§°ï¼‰ã®æŠ½å‡º

# åå‰ã‹ã‚‰ "Mr.", "Miss." ãªã©ã‚’æŠ½å‡º
all_data['Title'] = all_data['Name'].str.extract(' ([A-Za-z]+)\.', expand=False)

# çã—ã„æ•¬ç§°ã‚’ã¾ã¨ã‚ã‚‹
all_data['Title'] = all_data['Title'].replace(['Mlle', 'Ms'], 'Miss')
all_data['Title'] = all_data['Title'].replace('Mme', 'Mrs')

# 10äººæœªæº€ã®çã—ã„æ•¬ç§°ã¯ "Rare" ã«ã¾ã¨ã‚ã‚‹
rare_titles = all_data['Title'].value_counts()[all_data['Title'].value_counts() < 10].index
all_data['Title'] = all_data['Title'].replace(rare_titles, 'Rare')


ğŸ“˜ è§£èª¬

ãªãœTitleãŒé‡è¦ï¼Ÿ

ä¹—å®¢ã®åå‰ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã€Œæ•¬ç§°ã€ãŒå«ã¾ã‚Œã¦ã„ã¾ã™:

Mr. â†’ æˆäººç”·æ€§

Miss. â†’ æœªå©šå¥³æ€§

Mrs. â†’ æ—¢å©šå¥³æ€§

Master. â†’ å°‘å¹´

ã“ã‚Œã¯ã€Œæ€§åˆ¥ã€ã€Œå¹´é½¢ã€ã€Œçµå©šçŠ¶æ³ã€ã‚’å…¨ã¦å«ã‚€è¶…å¼·åŠ›ãªç‰¹å¾´ã§ã™ã€‚

ä¾‹: "Braund, Mr. Owen Harris" â†’ ã“ã®äººã¯æˆäººç”·æ€§

B. FamilySizeï¼ˆå®¶æ—ã®äººæ•°ï¼‰

# SibSpï¼ˆå…„å¼Ÿãƒ»é…å¶è€…ï¼‰ + Parchï¼ˆè¦ªãƒ»å­ä¾›ï¼‰ + 1ï¼ˆæœ¬äººï¼‰
all_data['FamilySize'] = all_data['SibSp'] + all_data['Parch'] + 1

# ä¸€äººæ—…ã‹ã©ã†ã‹
all_data['IsAlone'] = (all_data['FamilySize'] == 1).astype(int)


ğŸ“˜ è§£èª¬

ä»®èª¬: å®¶æ—ã¨ä¸€ç·’ã«ã„ã‚‹äººã¯åŠ©ã‹ã‚Šã‚„ã™ã„ï¼Ÿä¸€äººæ—…ã®äººã¯ä¸åˆ©ï¼Ÿ

å®Ÿéš›ã€ä¸€äººæ—…ã®ä¹—å®¢ã¯ç”Ÿå­˜ç‡ãŒä½ã„ã“ã¨ãŒåˆ†ã‹ã£ã¦ã„ã¾ã™ã€‚å®¶æ—ãŒã„ã‚‹ã¨åŠ©ã‘åˆãˆã‚‹ãŸã‚ã§ã™ã€‚

C. Deckï¼ˆãƒ‡ãƒƒã‚­éšï¼‰

# Cabinï¼ˆå®¢å®¤ç•ªå·ï¼‰ã®æœ€åˆã®æ–‡å­—ãŒãƒ‡ãƒƒã‚­éšã‚’è¡¨ã™
# ä¾‹: "C85" â†’ ãƒ‡ãƒƒã‚­C
all_data['Deck'] = all_data['Cabin'].apply(lambda s: s[0] if pd.notnull(s) else 'U')


ğŸ“˜ è§£èª¬

å®¢å®¤ç•ªå·ã®æœ€åˆã®æ–‡å­—ï¼ˆA, B, C...ï¼‰ã¯èˆ¹ã®ã©ã®éšã«ã„ãŸã‹ã‚’è¡¨ã—ã¾ã™ã€‚

é«˜ã„éšï¼ˆA, B, Cï¼‰â†’ ãŠé‡‘æŒã¡ â†’ è„±å‡ºã—ã‚„ã™ã„

'U'ï¼ˆUnknownï¼‰â†’ å®¢å®¤ç•ªå·ä¸æ˜ â†’ ãŠãã‚‰ãå®‰ã„éƒ¨å±‹

D. Ticket_Frequencyï¼ˆæœ€å¼·ã®ç‰¹å¾´ï¼ï¼‰

# åŒã˜ãƒã‚±ãƒƒãƒˆç•ªå·ã‚’æŒã¤äººã®æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
ticket_counts = all_data['Ticket'].value_counts()
all_data['Ticket_Frequency'] = all_data['Ticket'].map(ticket_counts)


ğŸ“˜ è§£èª¬

ã“ã‚ŒãŒä»Šå›ã®ç§˜å¯†å…µå™¨ï¼

åŒã˜ãƒã‚±ãƒƒãƒˆç•ªå·ã‚’æŒã¤äººã¯ã€Œå®¶æ—ã‚„å‹äººã®ã‚°ãƒ«ãƒ¼ãƒ—ã€ã§ã‚ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ã€‚

SibSp/Parchã«å«ã¾ã‚Œãªã„è¦ªæˆšã‚„å‹äººã‚‚å«ã¾ã‚Œã‚‹

ã‚°ãƒ«ãƒ¼ãƒ—ã§è¡Œå‹• â†’ åŠ©ã‘åˆã„ã‚„ã™ã„ â†’ ç”Ÿå­˜ç‡UP

ã“ã®ç‰¹å¾´ã ã‘ã§ã‚¹ã‚³ã‚¢ãŒå¤§ããå‘ä¸Šã—ã¾ã—ãŸã€‚

E. æ¬ æå€¤ã®è£œå®Œ

# å¹´é½¢ï¼šåŒã˜Title & Pclass ã®ä¸­å¤®å€¤ã§åŸ‹ã‚ã‚‹
all_data['Age'] = all_data.groupby(['Title', 'Pclass'])['Age'].transform(
    lambda x: x.fillna(x.median())
)

# æ–™é‡‘ï¼šå…¨ä½“ã®ä¸­å¤®å€¤ã§åŸ‹ã‚ã‚‹
all_data['Fare'] = all_data['Fare'].fillna(all_data['Fare'].median())

# ä¹—èˆ¹æ¸¯ï¼šæœ€é »å€¤ï¼ˆSï¼‰ã§åŸ‹ã‚ã‚‹
all_data['Embarked'] = all_data['Embarked'].fillna(all_data['Embarked'].mode()[0])


ğŸ“˜ è§£èª¬

æ¬ æå€¤ï¼ˆç©ºç™½ï¼‰ãŒã‚ã‚‹ã¨æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ãŒå‹•ãã¾ã›ã‚“ã€‚ãã“ã§:

Age: "Mr."ã¨"Master."ã§ã¯å¹´é½¢ãŒå…¨ç„¶é•ã†ã®ã§ã€åŒã˜Title+Pclassã®ä¸­å¤®å€¤ã‚’ä½¿ã†

Fare: ã‚·ãƒ³ãƒ—ãƒ«ã«å…¨ä½“ã®ä¸­å¤®å€¤

Embarked: æœ€ã‚‚å¤šã„æ¸¯ï¼ˆS = Southamptonï¼‰ã§åŸ‹ã‚ã‚‹

F. Fare_logï¼ˆæ–™é‡‘ã®å¯¾æ•°å¤‰æ›ï¼‰

# æ–™é‡‘ã¯åã‚ŠãŒå¤§ãã„ï¼ˆæ•°å††ã€œæ•°ç™¾ãƒ‰ãƒ«ï¼‰ã®ã§å¯¾æ•°å¤‰æ›
all_data['Fare_log'] = np.log1p(all_data['Fare'])


ğŸ“˜ è§£èª¬

æ–™é‡‘ã¯ã€Œ7ãƒ‰ãƒ«ã€ã®äººã‚‚ã„ã‚Œã°ã€Œ500ãƒ‰ãƒ«ã€ã®äººã‚‚ã„ã¾ã™ï¼ˆåã‚ŠãŒæ¿€ã—ã„ï¼‰ã€‚

ã“ã®ã¾ã¾ã ã¨é«˜é¡ãªæ–™é‡‘ã«å¼•ã£å¼µã‚‰ã‚Œã¦ã—ã¾ã†ã®ã§ã€å¯¾æ•°å¤‰æ›ã§ã€Œå·®ã‚’ç¸®ã‚ã‚‹ã€å‡¦ç†ã‚’ã—ã¾ã™ã€‚

ã‚¤ãƒ¡ãƒ¼ã‚¸:

å¤‰æ›å‰: 10, 100, 1000ï¼ˆå¤§ããªå·®ï¼‰

å¤‰æ›å¾Œ: 1, 2, 3ï¼ˆãªã ã‚‰ã‹ãªå·®ï¼‰

G. ãƒ“ãƒ‹ãƒ³ã‚°ï¼ˆã‚«ãƒ†ã‚´ãƒªåŒ–ï¼‰

# å¹´é½¢ã¨æ–™é‡‘ã‚’5æ®µéšãƒ»4æ®µéšã®ã‚«ãƒ†ã‚´ãƒªã«åˆ†ã‘ã‚‹
all_data['AgeBin'] = pd.qcut(all_data['Age'], 5, labels=False, duplicates='drop')
all_data['FareBin'] = pd.qcut(all_data['Fare_log'], 4, labels=False, duplicates='drop')


ğŸ“˜ è§£èª¬

ãƒ“ãƒ‹ãƒ³ã‚° = é€£ç¶šçš„ãªæ•°å€¤ã‚’ã€Œã‚°ãƒ«ãƒ¼ãƒ—ã€ã«åˆ†ã‘ã‚‹ã“ã¨

ä¾‹: å¹´é½¢

22æ­³ ã¨ 23æ­³ ã¯ä¼¼ã¦ã„ã‚‹ãŒã€æ©Ÿæ¢°å­¦ç¿’ã§ã¯ã€Œåˆ¥ã®å€¤ã€ã¨èªè­˜ã•ã‚Œã‚‹

â†’ ã€Œ20ä»£å‰åŠã€ã¨ã„ã†ã‚°ãƒ«ãƒ¼ãƒ—ã«ã¾ã¨ã‚ã‚‹æ–¹ãŒå­¦ç¿’ã—ã‚„ã™ã„

5ï¸âƒ£ ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™

# ä¸è¦ãªåˆ—ã‚’å‰Šé™¤
drop_cols = ['PassengerId', 'Name', 'Ticket', 'Cabin', 'Age', 'Fare', 
             'Fare_log', 'SibSp', 'Parch', 'FamilySize']
all_data_clean = all_data.drop(drop_cols, axis=1)

# ã‚«ãƒ†ã‚´ãƒªå¤‰æ•°ã‚’ãƒ€ãƒŸãƒ¼å¤‰æ•°åŒ–ï¼ˆæ–‡å­— â†’ æ•°å­—ï¼‰
all_data_encoded = pd.get_dummies(
    all_data_clean, 
    columns=['Title', 'Deck', 'Embarked', 'Sex'], 
    drop_first=True
)

# è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã¨ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã«åˆ†å‰²
X_train = all_data_encoded[:len(train_df)]
X_test = all_data_encoded[len(train_df):]
y_train = train_df['Survived']

print("æœ€çµ‚çš„ãªè¨“ç·´ãƒ‡ãƒ¼ã‚¿ã®å½¢:", X_train.shape)


ğŸ“˜ è§£èª¬

ãƒ€ãƒŸãƒ¼å¤‰æ•°åŒ–: æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã¯ã€Œæ–‡å­—ã€ã‚’ç†è§£ã§ãã¾ã›ã‚“ã€‚

ä¾‹: Sexï¼ˆæ€§åˆ¥ï¼‰

"male" / "female" â†’ 1 / 0 ã«å¤‰æ›

drop_first=True: å†—é•·ãªåˆ—ã‚’å‰Šé™¤ï¼ˆmale=1 ãªã‚‰ female=0 ã¯è‡ªæ˜ãªã®ã§ä¸è¦ï¼‰

6ï¸âƒ£ Optunaã§ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–

Optunaã£ã¦ä½•ï¼Ÿ

Optuna = ã€Œæœ€é©ãªè¨­å®šã€ã‚’è‡ªå‹•ã§æ¢ã—ã¦ãã‚Œã‚‹ãƒ„ãƒ¼ãƒ«

æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã«ã¯ã€Œãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€ã¨ã„ã†è¨­å®šå€¤ãŒã‚ã‚Šã¾ã™:

æœ¨ã®æ·±ã•

å­¦ç¿’ç‡

æœ¨ã®æ•°

ã“ã‚Œã‚’æ‰‹å‹•ã§è©¦ã™ã®ã¯å¤§å¤‰ â†’ Optunaã«ä»»ã›ã‚‹ï¼

def objective(trial):
    # Optunaã«ã€Œã“ã®ç¯„å›²ã§è©¦ã—ã¦ã€ã¨æŒ‡ç¤º
    params = {
        'objective': 'binary',
        'metric': 'binary_logloss',
        'verbosity': -1,
        'boosting_type': 'gbdt',
        'n_estimators': trial.suggest_int('n_estimators', 100, 1000),
        'learning_rate': trial.suggest_float('learning_rate', 0.01, 0.3),
        'num_leaves': trial.suggest_int('num_leaves', 20, 300),
        'max_depth': trial.suggest_int('max_depth', 3, 12),
        'min_child_samples': trial.suggest_int('min_child_samples', 5, 100),
        'subsample': trial.suggest_float('subsample', 0.6, 1.0),
        'colsample_bytree': trial.suggest_float('colsample_bytree', 0.6, 1.0),
        'random_state': 42
    }
    
    model = LGBMClassifier(**params)
    cv = StratifiedKFold(n_splits=5, shuffle=True, random_state=42)
    scores = cross_val_score(model, X_train, y_train, cv=cv, scoring='accuracy')
    
    # å¹³å‡ã‚¹ã‚³ã‚¢ã‚’è¿”ã™ï¼ˆOptunaã¯ã“ã‚Œã‚’æœ€å¤§åŒ–ã—ã‚ˆã†ã¨ã™ã‚‹ï¼‰
    return scores.mean()

# æœ€é©åŒ–ã‚’å®Ÿè¡Œï¼ˆ50å›è©¦è¡Œï¼‰
study = optuna.create_study(direction='maximize')
study.optimize(objective, n_trials=50)

print(f"\nOptunaãŒè¦‹ã¤ã‘ãŸæœ€é«˜ã‚¹ã‚³ã‚¢: {study.best_value:.4f}")
print(f"ãƒ™ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿: {study.best_params}")


ğŸ“˜ è§£èª¬

Optunaã®å‹•ã:

1å›ç›®: ãƒ©ãƒ³ãƒ€ãƒ ã«è¨­å®šã‚’è©¦ã™ â†’ ã‚¹ã‚³ã‚¢ 0.81

2å›ç›®: ã€Œã•ã£ãã‚ˆã‚Šè‰¯ã•ãã†ãªè¨­å®šã€ã‚’è©¦ã™ â†’ ã‚¹ã‚³ã‚¢ 0.82

3å›ç›®: ã•ã‚‰ã«æ”¹å–„ â†’ ã‚¹ã‚³ã‚¢ 0.84

...50å›ç¹°ã‚Šè¿”ã™

çµæœ: CV Score 0.8406 ã¨ã„ã†é«˜ã„ç²¾åº¦ã‚’é”æˆï¼

7ï¸âƒ£ ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«å­¦ç¿’ï¼ˆè¤‡æ•°ãƒ¢ãƒ‡ãƒ«ã®çµ„ã¿åˆã‚ã›ï¼‰

ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ã¨ã¯ï¼Ÿ

1ã¤ã®ãƒ¢ãƒ‡ãƒ«ã‚ˆã‚Šã€3äººã®å°‚é–€å®¶ã®æ„è¦‹ã‚’èãæ–¹ãŒæ­£ç¢º

ä¾‹ãˆã°:

å°‚é–€å®¶A: ã€Œç”Ÿå­˜ã€

å°‚é–€å®¶B: ã€Œç”Ÿå­˜ã€

å°‚é–€å®¶C: ã€Œæ­»äº¡ã€ â†’ å¤šæ•°æ±ºã§ã€Œç”Ÿå­˜ã€ã¨åˆ¤å®š

# 3ã¤ã®ãƒ¢ãƒ‡ãƒ«ã‚’æº–å‚™
rf = RandomForestClassifier(
    n_estimators=200, 
    max_depth=8, 
    min_samples_leaf=2, 
    random_state=42
)

gb = GradientBoostingClassifier(
    n_estimators=300, 
    learning_rate=0.01, 
    max_depth=4, 
    random_state=42
)

# Optunaã§æœ€é©åŒ–ã—ãŸLightGBM
best_lgbm_params = study.best_params
lgbm_best = LGBMClassifier(**best_lgbm_params, random_state=42)

# 3ã¤ã‚’çµ„ã¿åˆã‚ã›ã‚‹ï¼ˆã‚½ãƒ•ãƒˆæŠ•ç¥¨ = ç¢ºç‡ã®å¹³å‡ï¼‰
voting_clf = VotingClassifier(
    estimators=[
        ('rf', rf),
        ('gb', gb),
        ('lgbm', lgbm_best)
    ],
    voting='soft'
)


ğŸ“˜ è§£èª¬

ä½¿ç”¨ã™ã‚‹3ã¤ã®ãƒ¢ãƒ‡ãƒ«:

Random Forestï¼ˆãƒ©ãƒ³ãƒ€ãƒ ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆï¼‰:

ãŸãã•ã‚“ã®æ±ºå®šæœ¨ã‚’ä½œã£ã¦å¤šæ•°æ±º

å®‰å®šæ€§ãŒé«˜ã„

Gradient Boostingï¼ˆå‹¾é…ãƒ–ãƒ¼ã‚¹ãƒ†ã‚£ãƒ³ã‚°ï¼‰:

å¼±ã„ãƒ¢ãƒ‡ãƒ«ã‚’å°‘ã—ãšã¤æ”¹å–„ã—ã¦ã„ã

ç²¾åº¦ãŒé«˜ã„

LightGBM:

é«˜é€Ÿã§é«˜ç²¾åº¦

Optunaã§æœ€é©åŒ–æ¸ˆã¿

voting='soft': å„ãƒ¢ãƒ‡ãƒ«ã®ã€Œç¢ºç‡ã€ã‚’å¹³å‡ã—ã¦åˆ¤å®šï¼ˆç¡¬ã„å¤šæ•°æ±ºã‚ˆã‚ŠæŸ”è»Ÿï¼‰

8ï¸âƒ£ è©•ä¾¡ã¨äºˆæ¸¬

# äº¤å·®æ¤œè¨¼ã§ã‚¹ã‚³ã‚¢ã‚’ç¢ºèª
cv = StratifiedKFold(n_splits=5, shuffle=True, random_state=42)
final_cv_scores = cross_val_score(voting_clf, X_train, y_train, cv=cv, scoring='accuracy')

print(f"\nã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ãƒ¢ãƒ‡ãƒ«ã®CVã‚¹ã‚³ã‚¢: {final_cv_scores.mean():.4f}")

# å…¨è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã§å­¦ç¿’
voting_clf.fit(X_train, y_train)

# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã§äºˆæ¸¬
predictions = voting_clf.predict(X_test)

# æå‡ºãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
submission = pd.DataFrame({
    'PassengerId': test_df['PassengerId'],
    'Survived': predictions
})
submission.to_csv('submission_final.csv', index=False)

print("\næå‡ºãƒ•ã‚¡ã‚¤ãƒ« 'submission_final.csv' å®Œæˆï¼")


9ï¸âƒ£ çµæœã¨æœ€å¤§ã®å­¦ã³: ã‚ªãƒ¼ãƒãƒ¼ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°

ğŸ“Š ã‚¹ã‚³ã‚¢ã®æ¯”è¼ƒ

âš ï¸ ã“ã®å·®ãŒæ„å‘³ã™ã‚‹ã“ã¨: ã‚ªãƒ¼ãƒãƒ¼ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°

ã‚ªãƒ¼ãƒãƒ¼ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ï¼ˆéå­¦ç¿’ï¼‰ ã¨ã¯ï¼Ÿ

å­¦æ ¡ã®è©¦é¨“ã§ä¾‹ãˆã‚‹ã¨:

è‰¯ã„å‹‰å¼·: å•é¡Œã®ã€Œè§£ãæ–¹ã€ã‚’ç†è§£ã™ã‚‹ â†’ åˆã‚ã¦è¦‹ã‚‹å•é¡Œã‚‚è§£ã‘ã‚‹

æ‚ªã„å‹‰å¼·: ç­”ãˆã‚’ä¸¸æš—è¨˜ã™ã‚‹ â†’ åŒã˜å•é¡Œã¯è§£ã‘ã‚‹ãŒã€å°‘ã—å¤‰ã‚ã‚‹ã¨è§£ã‘ãªã„

æ©Ÿæ¢°å­¦ç¿’ã§ã‚‚åŒã˜ã“ã¨ãŒèµ·ãã¾ã™:

è‰¯ã„ãƒ¢ãƒ‡ãƒ«: ãƒ‡ãƒ¼ã‚¿ã®ã€Œãƒ‘ã‚¿ãƒ¼ãƒ³ã€ã‚’å­¦ã¶ â†’ æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã§ã‚‚äºˆæ¸¬ã§ãã‚‹

éå­¦ç¿’ãƒ¢ãƒ‡ãƒ«: è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã®ã€Œç´°ã‹ã„ãƒã‚¤ã‚ºã€ã¾ã§è¦šãˆã‚‹ â†’ æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã§å¤±æ•—

ğŸ” ãªãœéå­¦ç¿’ãŒèµ·ããŸã‹ï¼Ÿ

ç‰¹å¾´é‡ãŒå¤šã™ããŸ: 20å€‹ã®ç‰¹å¾´é‡ã¯891äººã®ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦å¤šã„

ãƒ¢ãƒ‡ãƒ«ãŒè¤‡é›‘ã™ããŸ: 3ã¤ã®ãƒ¢ãƒ‡ãƒ«ã‚’çµ„ã¿åˆã‚ã›ã€é«˜åº¦ã«ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã—ãŸ

è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã«éå‰°é©å¿œ: CVã‚¹ã‚³ã‚¢ã‚’ä¸Šã’ã‚‹ã“ã¨ã«é›†ä¸­ã—ã™ããŸ

ğŸ’¡ å¯¾ç­–æ–¹æ³•

ç‰¹å¾´é‡ã®å‰Šæ¸›: é‡è¦åº¦ã®ä½ã„ç‰¹å¾´ã¯å‰Šé™¤

æ­£å‰‡åŒ–: ãƒ¢ãƒ‡ãƒ«ã®è¤‡é›‘ã•ã«ãƒšãƒŠãƒ«ãƒ†ã‚£ã‚’ä¸ãˆã‚‹

ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ¢ãƒ‡ãƒ«: è¤‡é›‘ã™ãã‚‹ãƒ¢ãƒ‡ãƒ«ã¯é¿ã‘ã‚‹

ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ : ã‚ˆã‚Šå¤šãã®ãƒ‡ãƒ¼ã‚¿ã§å­¦ç¿’ï¼ˆTitanicã§ã¯ç„¡ç†ï¼‰

ğŸ“ ã¾ã¨ã‚

âœ… å­¦ã‚“ã ã“ã¨

ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã®é‡è¦æ€§

Ticket_Frequency ãŒæœ€å¤§ã®æ­¦å™¨

å‰µé€ çš„ãªç‰¹å¾´ä½œæˆãŒç²¾åº¦ã‚’å·¦å³

Optunaã®å¨åŠ›

æ‰‹å‹•ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã‚ˆã‚ŠåŠ¹ç‡çš„

50å›ã®è©¦è¡Œã§æœ€é©è§£ã‚’ç™ºè¦‹

ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ã®å¼·ã•

è¤‡æ•°ãƒ¢ãƒ‡ãƒ«ã®çµ„ã¿åˆã‚ã›ã§å®‰å®šæ€§UP

voting='soft' ã§æŸ”è»Ÿãªåˆ¤å®š

éå­¦ç¿’ã®ææ€–ï¼ˆæœ€é‡è¦ï¼‰

CVã‚¹ã‚³ã‚¢ã ã‘ã‚’ä¿¡ã˜ã¦ã¯ã„ã‘ãªã„

æ±åŒ–æ€§èƒ½ï¼ˆæ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã¸ã®å¯¾å¿œåŠ›ï¼‰ãŒæœ¬å½“ã®å®ŸåŠ›

ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ã‚ˆã‚Šå¤šãã®Kaggleã‚³ãƒ³ãƒšã«æŒ‘æˆ¦

éå­¦ç¿’ã‚’é˜²ããƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’å­¦ã¶

ä»–ã®äººã®Notebookã‹ã‚‰å­¦ã¶

